pipeline {
    agent any
    

    tools{ //herramientas utilizadas para la ejecucion, previamente configuradas
        gradle 'gradle'
    }
    environment { //parametros
        TAG = "${params.TAG}"
    }
    
    stages{  //etapas, se define el trabajo del pipeline dividido en bloques stage
        stage('git clone'){
            steps{
                //clono el repositorio desde Github
                git branch: 'main', url: 'https://github.com/mbelengonzalez168/Framework_Academia_Tsoft.git'
            }
        }
        stage('Xvfb') {
            steps {
                sh 'Xvfb :99 -ac -screen 0 1280x1024x24 & export DISPLAY=$DISPLAY'
      }
    }
        stage('exec gradle'){
            steps{
                //imprimo la version de graddle
                sh 'gradle --version'
                sh 'gradle runWithCucumber -P tags="@$TAG"' //${tag)} utilizacion del parametro
                sh 'ls'
            }
        }
        stage('load test execution'){
            steps {
                sh 'bash tokenXray.sh'
                script {
                    switch(healenium) {
                        case "Si":
                            sh '''cd results && export tempUrl=$(cat url.txt) && curl -H 'Authorization: Basic QVRBVFQzeEZmR0YwMVdPa0wzamk1MWMzSnp0NjRnZ3otOHdCUXNjUkZ6Mm5XUG5QdExwMVlURXE0eU44ak4yWW5IdFN2WXJ5RGt4NzI1aFhDeDh6WWVGWDFnbEdzbXdwZ3Y4dF9lcUhjd1NScGNDc1p3ajlOWnUzbVRHRDZ6RF9LWFc0Q2IzMXRzbjh5MTVfVVRYdVJpeThtWnN2Z0RqV2ExRzluWXRkSkxWUFNxc29XZjJFcFA0PUFBRjM2MkZE'
                            break
                        case "No":
                            sh '''cd results && export tempUrl=$(cat url.txt) && curl -H 'Authorization: Basic QVRBVFQzeEZmR0YwMVdPa0wzamk1MWMzSnp0NjRnZ3otOHdCUXNjUkZ6Mm5XUG5QdExwMVlURXE0eU44ak4yWW5IdFN2WXJ5RGt4NzI1aFhDeDh6WWVGWDFnbEdzbXdwZ3Y4dF9lcUhjd1NScGNDc1p3ajlOWnUzbVRHRDZ6RF9LWFc0Q2IzMXRzbjh5MTVfVVRYdVJpeThtWnN2Z0RqV2ExRzluWXRkSkxWUFNxc29XZjJFcFA0PUFBRjM2MkZE'
                            break
                        default:
                            echo 'Problemas al cargar la variable Healenium'
                            break
                    }
                }
            }
        }
    }
}